<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- ModelTrackingMapper.xml -->
<mapper namespace="com.example.demo.mappers.ModelTrackingMapper">
	
	<resultMap type="com.example.demo.entity.Subcontractor" id="modelTrackingResultMap">
		<result property="mtId" column="mt_id" />
		<result property="mtFkContractId" column="mt_fk_contract_id" />
		<result property="mtFkMessageModelId" column="mt_fk_message_model_id" />
		<result property="mtFkStatusId" column="mt_fk_status_id" />
		<result property="mtFkCategoryId" column="mt_fk_category_id" />
		<result property="mtSendDate" column="mt_send_date" />
		<result property="mtValidationDate" column="mt_validation_date" />
        <association property="status" javaType="com.example.demo.entity.Status">
            <id property="mtId" column="mt_id"/>
<!--            <result property="stName" column="st_name"/>-->
        </association>
	</resultMap>

    <insert id="insertGstModelTracking" statementType="PREPARED" useGeneratedKeys="true" keyProperty="mtId" keyColumn="mt_id" parameterType="com.example.demo.entity.ModelTracking">
        INSERT INTO schema_dev.gst_model_tracking (
            mt_send_date, mt_validation_date, mt_fk_contract_id, mt_fk_message_model_id, mt_fk_status_id, mt_fk_category_id
        )
        VALUES (
            #{mtSendDate}, #{mtValidationDate}, #{mtFkContractId}, #{mtFkMessageModelId}, #{mtFkStatusId}, #{mtFkCategoryId}
        )
    </insert>

    <update id="updateModelTracking" >
        UPDATE schema_dev.gst_model_tracking
        SET mt_send_date = #{mtSendDate},
            mt_validation_date = #{mtValidationDate},
            mt_fk_contract_id = #{mtFkContractId},
            mt_fk_message_model_id = #{mtFkMessageModelId},
            mt_fk_status_id = #{mtFkStatusId},
            mt_fk_category_id = #{mtFkCategoryId}
        WHERE mt_fk_contract_id = #{mtFkContractId}
          AND mt_fk_message_model_id = #{mtFkMessageModelId}
    </update>

    <select id="findAllModelTrackingInfo" resultType="com.example.demo.dto.ModelTrackingDTO">
        SELECT
            mt.mt_id AS mtId,
            mt.mt_send_date AS mtSendDate,
            mt.mt_validation_date AS mtValidationDate,
            mt.mt_fk_contract_id AS mtFkContractId,
            mt.mt_fk_message_model_id AS mtFkMessageModelId,
            mt.mt_fk_status_id AS mtFkStatusId,
            mt.mt_fk_category_id AS mtFkCategoryId
        FROM schema_dev.gst_model_tracking mt
    </select>

    <select id="getModelTrackingInfoByContractId" resultType="com.example.demo.dto.ModelTrackingDTO" parameterType="int">
        SELECT
            mt.mt_id AS mtId,
            mt.mt_send_date AS mtSendDate,
            mt.mt_validation_date AS mtValidationDate,
            mt.mt_fk_contract_id AS mtFkContractId,
            mt.mt_fk_message_model_id AS mtFkMessageModelId,
            mt.mt_fk_status_id AS mtFkStatusId,
            mt.mt_fk_category_id AS mtFkCategoryId
        FROM schema_dev.gst_model_tracking mt
        WHERE mt.mt_fk_contract_id = #{contractId}
    </select>

    <select id="findModelTrackingInfoByMmId" resultType="com.example.demo.dto.ModelTrackingDTO" parameterType="int">
        SELECT
            mt.mt_id AS mtId,
            mt.mt_send_date AS mtSendDate,
            mt.mt_validation_date AS mtValidationDate,
            mt.mt_fk_contract_id AS mtFkContractId,
            mt.mt_fk_message_model_id AS mtFkMessageModelId,
            mt.mt_fk_status_id AS mtFkStatusId,
            mt.mt_fk_category_id AS mtFkCategoryId
        FROM schema_dev.gst_model_tracking mt
        WHERE mt.mt_fk_message_model_id = #{mmId}
    </select>

    <select id="findModelTrackingInfoByContractIdAndMmId" resultType="com.example.demo.dto.ModelTrackingDTO" parameterType="int">
        SELECT
            mt.mt_id AS mtId,
            mt.mt_send_date AS mtSendDate,
            mt.mt_validation_date AS mtValidationDate,
            mt.mt_fk_contract_id AS mtFkContractId,
            mt.mt_fk_message_model_id AS mtFkMessageModelId,
            mt.mt_fk_status_id AS mtFkStatusId,
            mt.mt_fk_category_id AS mtFkCategoryId
        FROM schema_dev.gst_model_tracking mt
        WHERE mt.mt_fk_contract_id = #{contractId}
          AND mt.mt_fk_message_model_id = #{mmId}
    </select>

</mapper>